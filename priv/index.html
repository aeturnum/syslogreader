<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/umbrellajs"></script> -->
    <style type="text/css">
        body {
            background-color: #1a1a1a;
            color: white;
            margin: 0;
        }

        main {
            position: absolute;
            top: 40px;
            bottom: 20px;
            width: 100%;
            height: 99%;
            overflow: auto;
        }

        p {
            margin: 0;
            padding: 0;
        }
    </style>
    <title>
        Syslog watcher
    </title>
</head>

<body>
    <main id="main"></main>
    <script type="application/javascript">
        function format_time(s) {
            return new Date(s * 1e3).toISOString().slice(-13, -5);
        }

        class myWebsocketHandler {
            setupSocket() {
                let loc = window.location;
                // this.socket = new WebSocket(`wss://${loc.hostname}/ws`)
                this.socket = new WebSocket(`wss://admin.drex.space/ws`)

                this.socket.addEventListener("message", (event) => {
                    let payload = JSON.parse(event.data);
                    let textBox = document.getElementById("main");
                    let scroll = false;
                    if (textBox.scrollHeight <= textBox.scrollTop + textBox.clientHeight) {
                        scroll = true;
                    }
                    let newLine = document.createElement("p");
                    newLine.innerHTML = `${format_time(payload["ts"])} ${payload["line"]}`;
                    let child = textBox.appendChild(newLine);
                    if (scroll) {
                        child.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "nearest" });
                    }

                })

                this.socket.addEventListener("close", () => {
                    this.setupSocket()
                })
            }

        }

        const websocketClass = new myWebsocketHandler()
        websocketClass.setupSocket()

    </script>
</body>

</html>